Yet another git-remote-hg
=========================

[The way git remote helpers work forces how to call them]

When you update, please read this file again, it likely will contain
important notes.

git-remote-hg is a git remote helper to interact with mercurial
repositories. Contrary to other such helpers[*], it doesn't use a
local mercurial clone under the hood, although it currently does
require mercurial to be installed for some of its libraries.

* This applies to the following tools:
  - https://github.com/felipec/git-remote-hg
  - https://github.com/rfk/git-remote-hg
  - https://github.com/cosmin/git-hg
  - https://github.com/todesschaf/git-hg
  - https://github.com/msysgit/msysgit/wiki/Guide-to-git-remote-hg
  - https://github.com/buchuki/gitifyhg/

The main focus at the moment is to make it work with mozilla-central
and related mercurial repositories and support Mozilla workflows (try
server, etc.).

Setup:
------

Install mercurial.
Add this directory to your PATH.

Usage:
------

$ git clone hg::<mercurial repo>

where <mercurial repo> can be a path to a local directory containing a
mercurial repository, or a http, https or ssh url.

Essentially, use git like you would for a git repository, but use a
hg:: url where you would use a git:// url.

See http://glandium.org/blog/?page_id=3438 for an example workflow for
Mozilla repositories.

Limitations:
------------

At the moment, push is limited to non-merge commits.

There is no support for the following mercurial features:
- obsolescence markers
- phases

Update notes:
-------------

Up to commit dd6cc7a0940598161c3a1403adf05658ebdf6560, git-remote-hg
would happily corrupt the repository in some cases involving file
renames or addition with the same name but a different case (e.g. FOO
=> Foo), when the git repository is on a case-insensitive file system
(most notably on OSX or Windows).
It now requires core.ignorecase to be false. If you cloned with an
earlier version, you should reclone from scratch.

Various other corruptions have been identified and you can detect them
with the following command:
  git hgdebug fsck

That command will advise what to do about those corruptions.

Starting with commit 0d5b3a2c69c820e657ef204dae17e2696e1ebd53, the tip
branch is not exposed anymore, and previously cloned repositories can
be confused by the situation. Moreover, the way the remote HEAD ref is
handled changed in a way that can confuse git.
To get in a better state, you can do the following:
- Save .git/config
- Run the following command:
    git remote show | xargs -L1 git remote rm
- Restore .git/config
- Edit .git/config and replace occurrences of `refs/heads/tip` with
  `refs/heads/branches/default/tip` or `refs/heads/bookmarks/@`,
  depending whether the corresponding remote exposes that bookmark
  (you can check with `git ls-remote`).
- Run the following command:
    git remote update
